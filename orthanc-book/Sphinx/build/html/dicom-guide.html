
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>通过Orthanc理解DICOM &#8212; Orthanc之书  documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="插件" href="plugins.html" />
    <link rel="prev" title="服务器端脚本Lua" href="users/lua.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Orthanc之书</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">内容 <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="users.html">用户手册</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">通过Orthanc理解DICOM</a></li>
<li class="toctree-l1"><a class="reference internal" href="plugins.html">插件</a></li>
<li class="toctree-l1"><a class="reference internal" href="developers.html">开发者手册</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrations.html">集成</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">常见问题</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">对Orthanc的贡献</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
              <li class="hidden-sm"></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="orthancdicom">
<span id="dicom-guide"></span><h1><a class="toc-backref" href="#id4">通过Orthanc理解DICOM</a><a class="headerlink" href="#orthancdicom" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#orthancdicom" id="id4">通过Orthanc理解DICOM</a><ul>
<li><a class="reference internal" href="#dicom" id="id5">DICOM文件格式</a><ul>
<li><a class="reference internal" href="#dicom-tags" id="id6">DICOM tags号</a></li>
<li><a class="reference internal" href="#pixel-data" id="id7">Pixel data</a></li>
<li><a class="reference internal" href="#model-of-the-real-world" id="id8">Model of the real world</a></li>
<li><a class="reference internal" href="#dicom-identifiers" id="id9">DICOM identifiers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3" id="id10">DICOM网络协议</a><ul>
<li><a class="reference internal" href="#overview" id="id11">Overview</a></li>
<li><a class="reference internal" href="#parameters-of-a-dicom-server" id="id12">Parameters of a DICOM server</a></li>
<li><a class="reference internal" href="#configuring-orthanc" id="id13">Configuring Orthanc</a></li>
<li><a class="reference internal" href="#c-echo-testing-connectivity" id="id14">C-Echo: Testing connectivity</a></li>
<li><a class="reference internal" href="#c-store-sending-images-to-a-server" id="id15">C-Store: Sending images to a server</a></li>
<li><a class="reference internal" href="#c-find-browsing-the-content-of-a-server" id="id16">C-Find: Browsing the content of a server</a></li>
<li><a class="reference internal" href="#c-move-query-retrieve" id="id17">C-Move: Query/retrieve</a></li>
<li><a class="reference internal" href="#using-http-instead-of-the-dicom-protocol" id="id18">Using HTTP instead of the DICOM protocol</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<p>This section of the Orthanc Book provides a <strong>gentle, informal,
high-level introduction to DICOM</strong>. We will try and map
DICOM’s own concepts to a modern terminology that should hopefully be
more easy to understand for software engineers diving for the first
time into DICOM. Once the concepts of this page are understood,
interested readers are invited to read a more formal textbook about
DICOM, such as the so-called “<a class="reference external" href="http://www.springer.com/us/book/9783642108495">Practical introduction and survival
guide</a>”, or to read
the full <a class="reference external" href="http://dicom.nema.org/medical/dicom/current/output/html/">DICOM specification</a>.</p>
<p>All the DICOM concepts that are defined in this introduction are
illustrated with <a class="reference external" href="http://www.orthanc-server.com/">Orthanc</a>, a
lightweight, yet powerful standalone DICOM server for healthcare and
medical research. As Orthanc is free and open-source software, it is a
good companion to learn DICOM.</p>
<div class="section" id="dicom">
<span id="dicom-format"></span><h2><a class="toc-backref" href="#id5">DICOM文件格式</a><a class="headerlink" href="#dicom" title="Permalink to this headline">¶</a></h2>
<p>The DICOM standard can be very roughly divided in 2 parts:</p>
<ol class="arabic simple">
<li>The part specifying the DICOM <strong>file format</strong>.</li>
<li>The part specifying the DICOM <strong>network protocol</strong>.</li>
</ol>
<p>The DICOM file format is the topic of the present section. It is
inherently similar to well-known formats such as JPEG, PNG or
TIFF. However, besides the so-called “<strong>pixel data</strong>” that encodes the
medical image itself, a DICOM file also embeds medical information.</p>
<div class="section" id="dicom-tags">
<span id="id1"></span><h3><a class="toc-backref" href="#id6">DICOM tags号</a><a class="headerlink" href="#dicom-tags" title="Permalink to this headline">¶</a></h3>
<p>The medical information encoded by a DICOM file is called a <strong>data
set</strong> and takes the form of a <a class="reference external" href="https://en.wikipedia.org/wiki/Associative_array">key-value associative array</a>.  Each value can
itself be a list of data sets (called a <strong>sequence</strong>), leading to a
hierarchical data structure that is much like a XML or JSON file.</p>
<p>In the DICOM terminology, each key is called a <strong>DICOM tag</strong>. The list
of the standard DICOM tags are normalized by an official dictionary,
each tag being identified by two 16-bit hexadecimal numbers. For
instance, the birth date of a patient is associated with the DICOM tag
<code class="docutils literal notranslate"><span class="pre">(0x0010,</span> <span class="pre">0x0030)</span></code>. Note that it is common to drop the “<code class="docutils literal notranslate"><span class="pre">0x</span></code>”
prefix and to simply write <code class="docutils literal notranslate"><span class="pre">0010,0030</span></code>. For better readability, it
is also common to nickname these DICOM tags with a <a class="reference external" href="https://en.wikipedia.org/wiki/CamelCase">camel case</a> English name (such as
“<em>PatientName</em>” or “<em>StudyDescription</em>”). The standard associates each
DICOM tag with a data type (a string, a date, a floating-point
number…), that is known as its <strong>value representation</strong>.</p>
<p>Here is how <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc Explorer</span></a> displays the
DICOM tags stored in a DICOM file (note that the file contains a
sequence identified by the tag <code class="docutils literal notranslate"><span class="pre">ProcedureCodeSequence</span> <span class="pre">(0x0008,</span>
<span class="pre">0x1032)</span></code>):</p>
<a class="reference internal image-reference" href="_images/DicomTags.png"><img alt="_images/DicomTags.png" class="align-center" src="_images/DicomTags.png" style="width: 450px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The DICOM file format also specifies the set of DICOM tags that are
mandatory or optional for each kind of imaging modality (CT, MR, NM,
CBCT, PET…). Such a specification is called a <strong>storage
service-object pair</strong> (storage SOP). Mandatory tags are called “<em>type
1</em>”, mandatory tags that can have a null value are called “<em>type 2</em>”,
and optional tags are called “<em>type 3</em>”.</p>
<p>The DICOM standard also allows vendors to introduce non-standard,
<strong>proprietary tags</strong> for their own use. Proprietary tags can be
identified by the fact that their first hexadecimal number is odd
(e.g. <code class="docutils literal notranslate"><span class="pre">(0x0009,</span> <span class="pre">0x0010)</span></code>). Obviously, such proprietary tags should
be avoided for maximal interoperability.</p>
</div>
<div class="section" id="pixel-data">
<span id="dicom-pixel-data"></span><h3><a class="toc-backref" href="#id7">Pixel data</a><a class="headerlink" href="#pixel-data" title="Permalink to this headline">¶</a></h3>
<p>The image itself is associated with the DICOM tag <code class="docutils literal notranslate"><span class="pre">PixelData</span> <span class="pre">(0x7fe0,</span>
<span class="pre">0x0010)</span></code>. The content of image can be compressed using many image
formats, such as JPEG, <a class="reference external" href="https://en.wikipedia.org/wiki/Lossless_JPEG">Lossless JPEG</a> or <a class="reference external" href="https://en.wikipedia.org/wiki/JPEG_2000">JPEG 2000</a>. Obviously,
non-destructive (lossless) compression should always be favored to
avoid any loss of medical information. Note that a DICOM file can also
act as a wrapper around a video encoded using <a class="reference external" href="https://en.wikipedia.org/wiki/MPEG-2">MPEG-2</a> or <a class="reference external" href="https://en.wikipedia.org/wiki/H.264/MPEG-4_AVC">H.264</a>.</p>
<p>The image compression algorithm can be identified by inspecting the
<strong>transfer syntax</strong> that is associated with the DICOM file in its
header.</p>
<p>In practice, few imaging devices in hospitals (besides the <a class="reference external" href="https://en.wikipedia.org/wiki/Picture_archiving_and_communication_system">PACS</a>
itself) support image compression. As a consequence, to ensure best
portability, the pixel data of most DICOM files circulating in
hospitals is <strong>uncompressed</strong>. In other words, the image is encoded as
a raw buffer, with a given width, height, pixel type (integer or
float), <a class="reference external" href="https://en.wikipedia.org/wiki/Color_depth">color depth</a>
(most often 8, 10, 12 bpp - <em>bits per pixel</em>) and photometric
interpretation (most often grayscale or RGB). The transfer syntax that
is associated with such uncompressed images can either be <a class="reference external" href="https://fr.wikipedia.org/wiki/Endianness">little
endian</a> (the most common
case) or big endian.</p>
<p>A DICOM image can be <strong>multi-frame</strong>, meaning that it encodes an array
of different image frames. This is for instance used to encode
uncompressed video sequences, that are often referred to as <strong>cine</strong>
or <strong>2D+t</strong> images (e.g. for <a class="reference external" href="https://en.wikipedia.org/wiki/Medical_ultrasound">ultrasound imaging</a>).</p>
<p><a class="reference external" href="https://bitbucket.org/sjodogne/orthanc/src/default/Resources/DicomConformanceStatement.txt">As written in its DICOM conformance statement</a>,
the Orthanc software can receive, store and send any kind of DICOM
images (i.e. all the standard transfer syntaxes are
supported). Furthermore, Orthanc can <a class="reference internal" href="faq/supported-images.html#supported-images"><span class="std std-ref">convert most uncompressed
images</span></a> to PNG images. The <a class="reference external" href="https://en.wikipedia.org/wiki/Portable_Network_Graphics">PNG format</a> was
chosen by Orthanc as it is lossless, is natively supported by many
browsers, software or programming frameworks, and is able to encode up
to 16bpp integer pixels. This on-the-fly conversion to PNG images is
what happens when previewing a DICOM image within <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc
Explorer</span></a>:</p>
<a class="reference internal image-reference" href="_images/PreviewInstance.png"><img alt="_images/PreviewInstance.png" class="align-center" src="_images/PreviewInstance.png" style="width: 400px;" /></a>
</div>
<div class="section" id="model-of-the-real-world">
<span id="model-world"></span><h3><a class="toc-backref" href="#id8">Model of the real world</a><a class="headerlink" href="#model-of-the-real-world" title="Permalink to this headline">¶</a></h3>
<p>This concludes our overview of the DICOM file format itself. It is now
important to give an overview of the so-called “<strong>DICOM model of the
real world</strong>” (<a class="reference external" href="http://dicom.nema.org/medical/dicom/current/output/html/part04.html#sect_C.6.1.1">source</a>):</p>
<a class="reference internal image-reference" href="_images/PS3.4_C.6-1.svg"><div align="center" class="align-center"><img alt="_images/PS3.4_C.6-1.svg" height="400px" src="_images/PS3.4_C.6-1.svg" /></div>
</a>
<p>This UML diagram shows that a given <strong>patient</strong> benefits during her
life from a set of medical imaging <strong>studies</strong>.  Each study is made of
a set of <strong>series</strong>. Each series is in turn a set of <strong>instances</strong>,
the latter being a synonym for a single DICOM file. In Orthanc’s
vocabulary, a <strong>DICOM resource</strong> is an umbrella term to talk either
about a patient, a study, a series or an instance.</p>
<p>Any imaging study can be associated with multiple series of
images. This is especially visible with nuclear medicine, as any
<a class="reference external" href="https://en.wikipedia.org/wiki/PET-CT">PET-CT-scan</a> study will
contain at least two separate series: the CT series and the PET
series. But any kind of imaging study will usually generate a set of
separate series. In general, a series can be thought of as either a
single 2D image (as in standard <a class="reference external" href="https://en.wikipedia.org/wiki/Digital_radiography">digital radiography</a>), a single 3D
volume (as in a <a class="reference external" href="https://en.wikipedia.org/wiki/CT_scan">CT-scan</a>),
or a 2D+t cine sequence. But a series might also encode a single PDF
report, a <a class="reference external" href="http://www.dclunie.com/pixelmed/DICOMSR.book.pdf">structured report</a>, a 3D+t image
(i.e. a temporal sequence of 3D images)…</p>
<p>In any case, the actual pixel data of a given series is spread across
multiple DICOM instances. This allows to split a single huge image
(medical imaging commonly deals with 4GB images) into hundreds of
small files of several megabytes, each of which can entirely fit in
the computer memory, at the price of a severe redundancy of the
medical information that is embedded within these files.</p>
<p>For each of these 4 kinds of DICOM resources, the DICOM standard
specifies a <strong>module</strong> as a set of DICOM tags that describe these
resources. For instance, the DICOM tag <em>PatientName</em> is part of the
patient module, whereas <em>SeriesDescription</em> is part of the series
module. Any storage service-object pair (as <a class="reference internal" href="#dicom-tags"><span class="std std-ref">defined above</span></a>) can be decomposed into a set of modules that make sense
for its associated type of modality, and whose conjunction forms
encodes all the medical information.</p>
<p>According to this model of the real world, the default Web interface
of Orthanc allows to browse from the patient level to the instance
level. Here is how <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc Explorer</span></a> displays
a series:</p>
<a class="reference internal image-reference" href="_images/RealWorld.png"><img alt="_images/RealWorld.png" class="align-center" src="_images/RealWorld.png" style="width: 450px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>On the left side of the interface, an overview of the patient module,
the study module and the series module is displayed. On the right side,
the multiple instances of the series are accessible.</p>
</div>
<div class="section" id="dicom-identifiers">
<span id="id2"></span><h3><a class="toc-backref" href="#id9">DICOM identifiers</a><a class="headerlink" href="#dicom-identifiers" title="Permalink to this headline">¶</a></h3>
<p>Very importantly, the DICOM standard specifies DICOM tags that allow
to index each single DICOM resource:</p>
<ul class="simple">
<li>Patients are indexed with <code class="docutils literal notranslate"><span class="pre">PatientID</span> <span class="pre">(0x0010,</span> <span class="pre">0x0020)</span></code> (part of the patient module).</li>
<li>Studies are indexed with <code class="docutils literal notranslate"><span class="pre">StudyInstanceUID</span> <span class="pre">(0x0020,</span> <span class="pre">0x000d)</span></code> (part of the study module).</li>
<li>Series are indexed with <code class="docutils literal notranslate"><span class="pre">SeriesInstanceUID</span> <span class="pre">(0x0020,</span> <span class="pre">0x000e)</span></code> (part of the series module).</li>
<li>Instances are indexed with <code class="docutils literal notranslate"><span class="pre">SOPInstanceUID</span> <span class="pre">(0x0008,</span> <span class="pre">0x0018)</span></code> (part of the SOP module).</li>
</ul>
<p>The DICOM standard orders <em>StudyInstanceUID</em>, <em>SeriesInstanceUID</em> and
<em>SOPInstanceUID</em> to be <a class="reference external" href="https://en.wikipedia.org/wiki/Globally_unique_identifier">globally unique</a>. In
other words, it is mandatory for two different imaging devices to
never generate the same identifiers, even if they are manufactured by
different vendors. Orthanc exploits this rule to derive its <a class="reference internal" href="faq/orthanc-ids.html#orthanc-ids"><span class="std std-ref">own
unique identifiers</span></a>.</p>
<p>Importantly, even if the <em>PatientID</em> must be unique inside a given
hospital, it is not guaranteed to be globally unique. This means that
different patients imaged in different hospitals might share the same
<em>PatientID</em>. For this reason, you should always browse from the study
level (and not from the patient level) as soon as you deal with an
application that handles patients from different hospitals.</p>
<p><em>Note:</em> The current version of the <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc Explorer</span></a> interface (1.3.2 at the time of writing) is
designed for single-hospital scenarios, and thus does not provide
study-level access. But the core engine of Orthanc does support
study-level access through its <a class="reference internal" href="users/rest.html#rest"><span class="std std-ref">REST API</span></a>.</p>
<p>Finally, the patient module is not always fully meaningful. This is
for instance the case in emergency imaging, where the <a class="reference external" href="https://en.wikipedia.org/wiki/Radiology_information_system">radiology
information system</a> might
not have previously encountered the imaged patient. In such a case, an
unique <code class="docutils literal notranslate"><span class="pre">AccessionNumber</span> <span class="pre">(0x0008,</span> <span class="pre">0x0050)</span></code> is associated with the
imaging study by the imaging device of the emergency room: The patient
module will be injected later on in the PACS once the administrative
information is available, as part of a reconciliation process.</p>
<p>In any case, the core engine Orthanc keeps an index of all these DICOM
identifiers (<em>PatientID</em>, <em>AccessionNumber</em>, <em>StudyInstanceUID</em>,
<em>SeriesInstanceUID</em> and <em>SOPInstanceUID</em>) and is able to quickly maps
them to its own <a class="reference internal" href="faq/orthanc-ids.html#orthanc-ids"><span class="std std-ref">internal identifiers</span></a>. This lookup
is implemented by the <code class="docutils literal notranslate"><span class="pre">/tools/lookup</span></code> URI of the <a class="reference internal" href="users/rest.html#rest"><span class="std std-ref">REST API of
Orthanc</span></a>.</p>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id10">DICOM网络协议</a><a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>This concludes our overview of the DICOM file format. <a class="reference internal" href="#dicom-format"><span class="std std-ref">As written
above</span></a>, we now describe the second main part of the
DICOM standard, i.e. the <strong>DICOM network protocol</strong>.</p>
<div class="section" id="overview">
<span id="dicom-protocol-overview"></span><h3><a class="toc-backref" href="#id11">Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h3>
<p>The DICOM protocol is actually one of the earliest example of <a class="reference external" href="https://en.wikipedia.org/wiki/Web_service">Web
services</a>, long before
the introduction of <a class="reference external" href="https://en.wikipedia.org/wiki/SOAP">SOAP</a> or
<a class="reference external" href="https://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>. It
allows to:</p>
<ol class="arabic simple">
<li><strong>Test the connection</strong> between two devices (<a class="reference internal" href="#dicom-echo"><span class="std std-ref">C-Echo</span></a>).</li>
<li><strong>Send images</strong> from the local imaging device to a remote device
(<a class="reference internal" href="#dicom-store"><span class="std std-ref">C-Store</span></a>).</li>
<li><strong>Search the content</strong> of a remote device (<a class="reference internal" href="#dicom-find"><span class="std std-ref">C-Find</span></a>).</li>
<li><strong>Retrieve images</strong> from a remote device (<a class="reference internal" href="#dicom-move"><span class="std std-ref">C-Move</span></a>).</li>
</ol>
<p>Here is a picture that summarizes some key concepts:</p>
<a class="reference internal image-reference" href="_images/Protocol.svg"><div align="center" class="align-center"><img alt="_images/Protocol.svg" height="200px" src="_images/Protocol.svg" /></div>
</a>
<p>In the DICOM terminology, the client of a DICOM service is called a
<strong>service class user</strong> (SCU), and the server that handles the requests
is called a <strong>service class provider</strong> (SCP). The client sends a
request that is encoded as a DICOM file (the <strong>command</strong>), and the
server answers with a DICOM file.</p>
<p>The connection of a DICOM client to a DICOM server is called an
<strong>association</strong>. Such an association starts with a handshake where the
client and the server agree on which commands can be exchanged between
them, and on which <a class="reference internal" href="#dicom-pixel-data"><span class="std std-ref">transfer syntaxes</span></a> are
supported. The result of this negotiation is called the <strong>presentation
context</strong>. Once the association is negotiated, this communication
channel can be used to successively send multiple, independent
commands.</p>
</div>
<div class="section" id="parameters-of-a-dicom-server">
<h3><a class="toc-backref" href="#id12">Parameters of a DICOM server</a><a class="headerlink" href="#parameters-of-a-dicom-server" title="Permalink to this headline">¶</a></h3>
<p>Historically, the DICOM protocol was designed to work over
<a class="reference external" href="https://en.wikipedia.org/wiki/Point-to-point_(telecommunications)">point-to-point links</a>.
Nowadays, the DICOM protocol is used over the <a class="reference external" href="https://en.wikipedia.org/wiki/Internet_protocol_suite">TCP/IP stack</a>.  This
implies that a DICOM server can be identified by specifying the
parameters of its <a class="reference external" href="https://en.wikipedia.org/wiki/Network_socket">network socket</a>:</p>
<ol class="arabic simple">
<li>Its <strong>IP address</strong> (or, equivalently, its symbolic DNS hostname).</li>
<li>Its <strong>TCP port</strong> (the standard DICOM port is 104, but Orthanc uses
the non-priviliged port 4242 by default).</li>
</ol>
<p>Furthermore, each imaging device (may it be a client or a server) must
be associated with a symbolic name that is called the <strong>application
entity title (AET)</strong>. The AET is assumed to be unique inside the
Intranet of the hospital. For best compatibility between vendors, the
AET should be only made of alphanumeric characters in upper case (plus
the “<code class="docutils literal notranslate"><span class="pre">-</span></code>” and “<code class="docutils literal notranslate"><span class="pre">_</span></code>” characters), and its length must be below 16
characters.</p>
<p>Taken together, the IP address, the TCP port and the AET describe all
the parameters of a DICOM server. The administrators of a medical
imaging network should carefully keep track of these parameters for
each imaging device, and should define an hospital-wide policy to
assign AETs to new devices.</p>
</div>
<div class="section" id="configuring-orthanc">
<h3><a class="toc-backref" href="#id13">Configuring Orthanc</a><a class="headerlink" href="#configuring-orthanc" title="Permalink to this headline">¶</a></h3>
<p>Orthanc can act both as a DICOM client and as a DICOM server,
depending on the parameters in its <a class="reference internal" href="users/configuration.html#configuration"><span class="std std-ref">configuration file</span></a>. To configure the <strong>DICOM server</strong> of Orthanc, the
following options are especially important:</p>
<ol class="arabic simple">
<li><code class="docutils literal notranslate"><span class="pre">DicomServerEnabled</span></code> must be set to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">DicomAet</span></code> must be set to the AET that is reserved to Orthanc.</li>
<li><code class="docutils literal notranslate"><span class="pre">DicomPort</span></code> specifies the TCP port of the DICOM server.</li>
</ol>
<p>To configure Orthanc as a <strong>DICOM client</strong>, you must list the remote DICOM
servers that are known to Orthanc into the <code class="docutils literal notranslate"><span class="pre">DicomModalities</span></code> option.
For each remote server, you must specify in the following order:</p>
<ol class="arabic simple">
<li>An user-friendly, symbolic name for the server that will be
displayed by <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc Explorer</span></a> (possibly
its AET).</li>
<li>The AET of the remote server.</li>
<li>Its IP address or its hostname.</li>
<li>Its DICOM port (most probably 104, or 4242 if the remote server is
another instance of Orthanc).</li>
</ol>
<p>Of course, after any change to the configuration of Orthanc, the
software must be restarted to take the new parameters into account.</p>
</div>
<div class="section" id="c-echo-testing-connectivity">
<span id="dicom-echo"></span><h3><a class="toc-backref" href="#id14">C-Echo: Testing connectivity</a><a class="headerlink" href="#c-echo-testing-connectivity" title="Permalink to this headline">¶</a></h3>
<p>Routers might block the DICOM protocol between separate <a class="reference external" href="https://en.wikipedia.org/wiki/Subnetwork">subnets</a> (often, only the HTTP,
HTTPS and SSH protocols are enabled by default). Furthermore, the
firewalls that are installed on the clients or on the servers might
also block the DICOM protocol. This is especially true for the
<a class="reference external" href="https://en.wikipedia.org/wiki/Windows_Firewall">Microsoft Windows firewall</a> and for
<a class="reference internal" href="faq/redhat.html#redhat"><span class="std std-ref">RedHat-based GNU/Linux boxes</span></a>. As a consequence, after
any change in the DICOM topology of an hospital (notably when
connecting two imaging devices), one should always check whether the
DICOM protocol can travel from end to end, i.e.  between the DICOM
client and the DICOM server.</p>
<p>This is where the <strong>DICOM Echo service</strong> comes into play. This service
is triggered when the client sends a so-called <code class="docutils literal notranslate"><span class="pre">C-Echo</span></code> command to
the server as its DICOM query. The server answers with an empty DICOM
answer. In practice, to test the connectivity between two devices, you
should:</p>
<ol class="arabic simple">
<li>Use the standard command-line tool <code class="docutils literal notranslate"><span class="pre">ping</span></code> to test the <strong>TCP-level
connectivity</strong> between the client and the server, then</li>
<li>Issue the <strong>C-Echo</strong> from the client to the server to test the
DICOM-level connectivity.</li>
</ol>
<p>The second step can be done directly from <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc Explorer</span></a>, the embedded administrative interface of Orthanc,
in the “<em>Query/Retrieve</em>” panel, as depicted below:</p>
<a class="reference internal image-reference" href="_images/Echo.png"><img alt="_images/Echo.png" class="align-center" src="_images/Echo.png" style="width: 450px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>In this screenshot, <code class="docutils literal notranslate"><span class="pre">sample</span></code> corresponds to the symbolic name of a
DICOM server that is declared in the <code class="docutils literal notranslate"><span class="pre">DicomModalities</span></code>
<a class="reference internal" href="users/configuration.html#configuration"><span class="std std-ref">configuration option</span></a>. Once DICOM Echo succeeds,
the client should be able to send images to the server, and to
initiate a query/retrieve. This is the topic of the following
sections.</p>
</div>
<div class="section" id="c-store-sending-images-to-a-server">
<span id="dicom-store"></span><h3><a class="toc-backref" href="#id15">C-Store: Sending images to a server</a><a class="headerlink" href="#c-store-sending-images-to-a-server" title="Permalink to this headline">¶</a></h3>
<p>The <strong>DICOM Store Service</strong> is used to send DICOM instances to a
remote imaging device. This service is triggered when the client sends
to the server a so-called <code class="docutils literal notranslate"><span class="pre">C-Store</span></code> command together with the
content of a DICOM instance. Schematically, C-Store works as follows:</p>
<a class="reference internal image-reference" href="_images/CStore.svg"><div align="center" class="align-center"><img alt="_images/CStore.svg" src="_images/CStore.svg" width="500px" /></div>
</a>
<p>Orthanc can act both as a C-Store client (SCU) or as a C-Store server
(SCP). In other words, it can either send or receive DICOM files.</p>
<p>In the <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc Explorer</span></a> interface, each
DICOM resource (patient, study, series or instance) comes with a
button entitled “<em>Send to remote modality</em>”. Clicking on this button
allows to send the image to any DICOM server that is declared in the
<code class="docutils literal notranslate"><span class="pre">DicomModalities</span></code> <a class="reference internal" href="users/configuration.html#configuration"><span class="std std-ref">configuration option</span></a>. In
the following screenshot, all the instances of one patient will be
sent to the device whose symbolic name is <code class="docutils literal notranslate"><span class="pre">sample</span></code>:</p>
<a class="reference internal image-reference" href="_images/CStoreGui.png"><img alt="_images/CStoreGui.png" class="align-center" src="_images/CStoreGui.png" style="width: 450px;" /></a>
</div>
<div class="section" id="c-find-browsing-the-content-of-a-server">
<span id="dicom-find"></span><h3><a class="toc-backref" href="#id16">C-Find: Browsing the content of a server</a><a class="headerlink" href="#c-find-browsing-the-content-of-a-server" title="Permalink to this headline">¶</a></h3>
<p>The <strong>DICOM Find Service</strong> is used to <strong>search</strong> a list of DICOM
resources that are hosted by some remote DICOM server. The kind of
resource that is looked for (patients, studies or series) must be
specified, leading to the <strong>query level</strong> of the query.  Besides the
query level, the query contains a set of filters on DICOM tags of
interest: These filters are essentially <a class="reference external" href="https://en.wikipedia.org/wiki/Glob_(programming)">wildcards</a> describing the
resources that are looked for. This service is triggered when the
client sends to the server a so-called <code class="docutils literal notranslate"><span class="pre">C-Find</span></code> command that encodes
the query level and the filters. Schematically, C-Find works as
follows:</p>
<a class="reference internal image-reference" href="_images/CFind.svg"><div align="center" class="align-center"><img alt="_images/CFind.svg" src="_images/CFind.svg" width="500px" /></div>
</a>
<p>Orthanc can act both as a C-Find client (SCU) or as a C-Find server
(SCP). In other words, it can be used to search the content of a
remote server, and conversely it can inform a remote client about its
own content.</p>
<p>In the <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc Explorer</span></a> interface, it
is possible to initiate a search at the study level. This feature
is available in the “<em>Query/Retrieve</em>” panel, as depicted below:</p>
<a class="reference internal image-reference" href="_images/CFindGui1.png"><img alt="_images/CFindGui1.png" class="align-center" src="_images/CFindGui1.png" style="width: 500px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>This screenshot shows that we are looking for a study whose associated
patient has a name that starts with “<em>Brain</em>”, and that is of MR
modality. Orthanc Explorer then lists the matching studies:</p>
<a class="reference internal image-reference" href="_images/CFindGui2.png"><img alt="_images/CFindGui2.png" class="align-center" src="_images/CFindGui2.png" style="width: 500px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>It is then possible to click on some matching study, to list the
individual series it is made of:</p>
<a class="reference internal image-reference" href="_images/CFindGui3.png"><img alt="_images/CFindGui3.png" class="align-center" src="_images/CFindGui3.png" style="width: 500px;" /></a>
</div>
<div class="section" id="c-move-query-retrieve">
<span id="dicom-move"></span><h3><a class="toc-backref" href="#id17">C-Move: Query/retrieve</a><a class="headerlink" href="#c-move-query-retrieve" title="Permalink to this headline">¶</a></h3>
<p>This brings us to the last important component of the DICOM network
protocol, the <strong>DICOM Move Service</strong>. This service is notably used to
locally retrieve DICOM files from a remote server, given the results
of a <a class="reference internal" href="#dicom-find"><span class="std std-ref">C-Find query</span></a>. Taken together, <code class="docutils literal notranslate"><span class="pre">C-Find</span></code> and
<code class="docutils literal notranslate"><span class="pre">C-Move</span></code> give rise to the <strong>query/retrieve</strong> mechanism at is at the
core of the exchange of DICOM files within the hospital.</p>
<p>C-Move is probably the part of the DICOM standard that is the less
intuitive, which leads to many configuration problems in medical
imaging networks. This stems from the fact that C-Move is actually not
limited to query/retrieve. It is a more generic protocol that can
involve up to <strong>3 distinct imaging devices</strong>, as depicted below:</p>
<a class="reference internal image-reference" href="_images/CMove.svg"><div align="center" class="align-center"><img alt="_images/CMove.svg" src="_images/CMove.svg" width="500px" /></div>
</a>
<p>Whenever an imaging device (called the <em>issuer</em> above) initiates a
C-Move command, it asks a DICOM server (called the <em>source</em> above) to
send some of its images to another DICOM server (called the <em>target</em>
above). Accordingly, a C-Move command encodes the <a class="reference internal" href="#dicom-identifiers"><span class="std std-ref">identifiers</span></a> of the DICOM resources to be sent, together with
the AET of the target server.  To put it in other words, a C-Move
command drives a <strong>C-Store between two remote DICOM servers</strong> (the
<em>source</em> and the <em>target</em>).</p>
<p>The query/retrieve mechanism corresponds to the special case of a
C-Move command where the target and the issuer are the same imaging
device. The most common configuration problem for query/retrieve is
therefore to forget to declare the AET of the “<em>issuer/target</em>” device
into the configuration of the “<em>source</em>” device.</p>
<p>Orthanc can act both as a C-Move client (SCU) or as a C-Move server
(SCP). This implies that Orthanc can either initiate a query/retrieve,
or be driven as part of a query/retrieve request. You might want to
give a look at the “<a class="reference internal" href="faq/query-retrieve.html#query-retrieve"><span class="std std-ref">Configuring DICOM Query/Retrieve</span></a>” section of this book to
learn how to concretely configure Orthanc for query/retrieve.</p>
<p>A C-Move session can be initiated from the <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc Explorer</span></a> interface, after a <a class="reference internal" href="#dicom-find"><span class="std std-ref">C-Find query</span></a> is complete. It is sufficient to click on the download
button that is to the right of the study or series of interest:</p>
<a class="reference internal image-reference" href="_images/CMoveGui1.png"><img alt="_images/CMoveGui1.png" class="align-center" src="_images/CMoveGui1.png" style="width: 500px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>A dialog box then pops up, asking the AET of the <em>target</em> modality.
By default, this field is pre-filled with the AET of Orthanc, which
corresponds to the initiation of a query/retrieve:</p>
<a class="reference internal image-reference" href="_images/CMoveGui2.png"><img alt="_images/CMoveGui2.png" class="align-center" src="_images/CMoveGui2.png" style="width: 500px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><em>Note 1:</em> Even if C-Move may seem counter-intuitive, this is the most
popular and widespread way to initiate a query/retrieve against a PACS
server. The DICOM standard features an <a class="reference external" href="http://dclunie.blogspot.be/2016/05/to-c-move-is-human-to-c-get-divine.html">alternative mechanism called
C-Get</a>.
As of Orthanc 1.3.2, C-Get is not supported yet (but work is in
progress).</p>
<p><em>Note 2:</em> As <a class="reference internal" href="#dicom-pixel-data"><span class="std std-ref">written above</span></a>, the Orthanc
engine is quite generic and is compatible with virtually any image
compression algorithm (aka. transfer syntax). In particular, during
the <a class="reference internal" href="#dicom-protocol-overview"><span class="std std-ref">negotiation of a presentation context</span></a>, Orthanc reports by default that it is
compatible with the JPEG 2000 encoding. This leads some PACS engines
to compress their images before sending them to Orthanc, so as to
reduce the network bandwidth. Unfortunately, because many medical
image analysis software are not compatible with such an image
compression, the JPEG 2000 image that is received by Orthanc might be
unusable by such software. You might therefore have to <strong>disable
transfer syntaxes</strong> by setting the <code class="docutils literal notranslate"><span class="pre">*TransferSyntaxAccepted</span></code> options
to <code class="docutils literal notranslate"><span class="pre">false</span></code> in the <a class="reference internal" href="users/configuration.html#configuration"><span class="std std-ref">configuration file of Orthanc</span></a> (by default, all the transfer syntaxes are enabled).</p>
</div>
<div class="section" id="using-http-instead-of-the-dicom-protocol">
<h3><a class="toc-backref" href="#id18">Using HTTP instead of the DICOM protocol</a><a class="headerlink" href="#using-http-instead-of-the-dicom-protocol" title="Permalink to this headline">¶</a></h3>
<p>We conclude this brief overview of DICOM by insisting on the fact that
the <strong>DICOM protocol inherently targets the Intranet</strong> of a single
hospital, not the Internet or the cloud. This protocol might be
blocked by outbound firewalls, and there is no convention ensuring
that the AETs are globally unique across all the
hospitals. Furthermore, even though the DICOM protocol supports TLS
encryption, this feature is rarely enabled.</p>
<p>Depending on your application, you might therefore want to leverage
the <strong>HTTP protocol</strong> in the context of DICOM. Such Web-based
protocols are probably more familiar to physicians/physicists/software
engineers, are easier to work with, can be transparently encrypted
(<strong>HTTPS</strong>), and are compatible with multiple-hospital scenarios. To
this end, you have two possibilities:</p>
<ol class="arabic simple">
<li>Resort to the <a class="reference internal" href="faq/features.html#peers"><span class="std std-ref">Orthanc peer</span></a> mechanism. Because each
Orthanc server comes with its built-in <a class="reference internal" href="users/rest.html#rest"><span class="std std-ref">REST API</span></a>,
remote systems can obtain a full programmatic control over the
content of Orthanc. This access can be secured by HTTP
authentication and <a class="reference internal" href="faq/https.html#https"><span class="std std-ref">SSL encryption</span></a>. The <a class="reference internal" href="users/cookbook.html#orthanc-explorer"><span class="std std-ref">Orthanc
Explorer</span></a> interface can transparently use this
peer mechanism to send DICOM files over HTTP(S).</li>
<li>Resort to the <a class="reference external" href="http://www.dicomweb.org/">DICOMweb standard</a>,
that is an extension to the DICOM standard specifying how to access
the content of a remote DICOM server through HTTP(S). Because the
peer mechanism is bound to Orthanc, DICOMweb offers a less
expressive, but more generic access to remote servers.
Importantly, a <a class="reference external" href="http://www.orthanc-server.com/static.php?page=dicomweb">DICOMweb plugin to Orthanc</a> is
freely available.</li>
</ol>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">回到顶上</a>
      
    </p>
    <p>

      &copy; Copyright 2015-2018, University Hospital of Liège and Osimis, Belgium<br/>
      The Orthanc Book 许可基于
      <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative 
        Commons CC-BY-SA 4.0</a>.<br/>
      使用<a href="http://sphinx-doc.org/">Sphinx</a>1.7.5创建.<br/>
      由<a href="http://www.aomiit.com">AOMIIT</a>团队翻译<br/>
      <li><a href="http://www.miibeian.gov.cn/">蜀ICP备14004673号</a></li>
     </p>
  </div>
</footer>

  </body>
</html>